"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGlobalStyle = void 0;
const tslib_1 = require("tslib");
const react_1 = tslib_1.__importStar(require("react"));
const client_1 = require("react-dom/client");
const styled_components_1 = require("styled-components");
const globalStyles = new Map();
let stylesRoot;
const ensureStylesRootReady = () => {
    if (stylesRoot) {
        return;
    }
    if (typeof window === 'undefined') {
        return console.warn('No document to render global styles');
    }
    const element = window.document.createElement('div');
    window.document.head.appendChild(element);
    stylesRoot = (0, client_1.createRoot)(element);
};
const useDedupedStyleRendering = (key, styleElement) => {
    const shouldUpdateStyles = !globalStyles.has(key);
    if (shouldUpdateStyles) {
        globalStyles.set(key, styleElement);
    }
    (0, react_1.useEffect)(() => {
        if (shouldUpdateStyles && stylesRoot) {
            const styleTags = Array.from(globalStyles).map((entry) => entry[1]);
            stylesRoot.render(react_1.default.createElement(react_1.default.Fragment, null, styleTags));
        }
    }, [shouldUpdateStyles]);
};
function createDedupedGlobalStyle(first, ...interpolations) {
    const GlobalStyle = (0, styled_components_1.createGlobalStyle)(first, ...interpolations);
    return ({ id }) => {
        const theme = (0, styled_components_1.useTheme)();
        ensureStylesRootReady();
        useDedupedStyleRendering(id, react_1.default.createElement(GlobalStyle, { key: id, theme: theme }));
        return null;
    };
}
exports.createGlobalStyle = createDedupedGlobalStyle;
//# sourceMappingURL=createDedupedGlobalStyle.js.map